!function(a,b){"use strict";var c=function(){return b.addEventListener?function(b,c,d){return b.addEventListener(c,d,!1)}:function(b,c,d){return b.attachEvent("on"+c,d)}}(),d=[60,96,156,248,310,480,620,800,960,1240,1720,2480],e="function"==typeof Object.keys?Object.keys:function(a){var c,b=[];for(c in a)b.push(c);return b},f=function(a,b){for(var c=0,d=a.length,e=[];c<d;c++)e[c]=b(a[c],c);return e},g=function(a){return a},h=function(){},i=function(){return!0},j=function(a,b){var c;return function(){var d=this,e=arguments,f=function(){c=null,a.apply(d,e)};clearTimeout(c),c=setTimeout(f,b)}},k=function(a,c){var f=this,g=b;c=c||{},void 0!==a&&("string"==typeof a?(c.selector=a,a=void 0):"undefined"==typeof a.length&&(c=a,a=void 0)),this.viewportHeight=g.documentElement.clientHeight,this.selector=a?null:c.selector||".lazyload",this.className=c.className||"image-replace",this.gif=g.createElement("img"),this.gif.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",this.gif.className=this.className,this.gif.alt="",this.lazyloadOffset=c.lazyloadOffset||0,this.scrollDelay=c.scrollDelay||250,this.onResize=!c.hasOwnProperty("onResize")||c.onResize,this.lazyload=!c.hasOwnProperty("lazyload")||c.lazyload,this.scrolled=!1,this.availableWidths=c.availableWidths||d,this.onImagesReplaced=c.onImagesReplaced||h,this.widthsMap={},"function"!=typeof this.availableWidths&&("number"==typeof this.availableWidths.length?this.widthsMap=k.createWidthsMap(this.availableWidths):(this.widthsMap=this.availableWidths,this.availableWidths=e(this.availableWidths)),this.availableWidths=this.availableWidths.sort(function(a,b){return a-b})),this.divs=[],this.add(a||this.selector),this.ready(c.onReady),setTimeout(function(){f.init()},0)};k.prototype.add=function(a){a=a||this.selector;var c="string"==typeof a?b.querySelectorAll(a):a;if(c&&c.length){var d=f(c,g);this.changeDivsToEmptyImages(d),this.divs=this.divs.concat(d)}},k.prototype.scrollCheck=function(){var b=this,c=0,d=[];this.scrolled&&(f(this.divs,function(a){b.isPlaceholder(a)&&(++c,b.isThisElementOnScreen(a)&&d.push(a))}),0===c&&a.clearInterval(b.interval),this.changeDivsToEmptyImages(d),this.scrolled=!1)},k.prototype.init=function(){var a=this;this.initialized=!0;var b=i;this.lazyload?(this.registerScrollEvent(),this.scrolled=!0,a.scrollCheck(),b=function(b){return a.isPlaceholder(b)===!1}):this.checkImagesNeedReplacing(this.divs),this.onResize&&this.registerResizeEvent(b),this.onReady()},k.prototype.ready=function(a){this.onReady=a||h},k.prototype.createGif=function(a){if(a.className.match(new RegExp("(^| )"+this.className+"( |$)")))return a;var b=a.getAttribute("data-class"),c=a.getAttribute("data-width"),d=this.gif.cloneNode(!1);return c&&(d.width=c,d.setAttribute("data-width",c)),d.className=(b?b+" ":"")+this.className,d.setAttribute("data-src",a.getAttribute("data-src")),a.getAttribute("data-sizes")&&d.setAttribute("data-sizes",a.getAttribute("data-sizes")),d.setAttribute("alt",a.getAttribute("data-alt")||this.gif.alt),a.parentNode.replaceChild(d,a),d},k.prototype.changeDivsToEmptyImages=function(a){var b=this;f(a,function(c,d){a[d]=b.createGif(c,"img")}),this.initialized&&this.checkImagesNeedReplacing(a)},k.prototype.isPlaceholder=function(a){return a.src===this.gif.src},k.prototype.isThisElementOnScreen=function(a){var b=0,c=k.getPageOffset()+this.lazyloadOffset;if(a.offsetParent)do b+=a.offsetTop;while(a=a.offsetParent);return b<this.viewportHeight+c},k.prototype.checkImagesNeedReplacing=function(a,b){var c=this;b=b||i,this.isResizing||(this.isResizing=!0,f(a,function(a){b(a)&&c.replaceImagesBasedOnScreenDimensions(a)}),this.isResizing=!1,this.onImagesReplaced(a))},k.prototype.replaceImagesBasedOnScreenDimensions=function(a){var b,c,d=!1;c=k.getNaturalWidth(a),b="function"==typeof this.availableWidths?this.availableWidths(a):this.determineAppropriateResolution(a);var e=a.getAttribute("data-src")||"";if(a.getAttribute("data-sizes")){var g,f=JSON.parse(a.getAttribute("data-sizes")),h=[];for(g in f)h.push(g);var i=k.getClosestValue(b,h);i<=b&&(d=!0,e=f[i])}a.width=b,d&&!this.isPlaceholder(a)&&b<=c||(a.src=this.changeImageSrcToUseNewImageDimensions(e,b),a.removeAttribute("width"),a.removeAttribute("height"))},k.prototype.determineAppropriateResolution=function(a){return k.getClosestValue(a.getAttribute("data-width")||a.parentNode.clientWidth,this.availableWidths)},k.prototype.changeImageSrcToUseNewImageDimensions=function(a,b){return a.replace(/{width}/g,k.transforms.width(b,this.widthsMap))},k.createWidthsMap=function(b){for(var c={},d=b.length;d--;)c[b[d]]=b[d];return c},k.transforms={width:function(a,b){return b[a]||a}},k.getClosestValue=function(b,c){var d=c.length,e=c[d-1];for(b=parseFloat(b);d--;)b<=c[d]&&(e=c[d]);return e},k.prototype.registerResizeEvent=function(b){var d=this;c(a,"resize",j(function(){d.checkImagesNeedReplacing(d.divs,b)},100))},k.prototype.registerScrollEvent=function(){var d=this;this.scrolled=!1,this.interval=a.setInterval(function(){d.scrollCheck()},d.scrollDelay),c(a,"scroll",function(){d.scrolled=!0}),c(a,"resize",function(){d.viewportHeight=b.documentElement.clientHeight,d.scrolled=!0})},k.getPageOffsetGenerator=function(d){return d?function(){return a.pageYOffset}:function(){return b.documentElement.scrollTop}},k.getNaturalWidth=function(){return"naturalWidth"in new Image?function(a){return a.naturalWidth}:function(a){var c=b.createElement("img");return c.src=a.src,c.width}}(),k.getPageOffset=k.getPageOffsetGenerator(Object.prototype.hasOwnProperty.call(a,"pageYOffset")),k.applyEach=f,k.addEvent=c,k.debounce=j,"object"==typeof module&&"object"==typeof module.exports?module.exports=exports=k:"function"==typeof define&&define.amd?define(function(){return k}):"object"==typeof a&&(a.Imager=k)}(window,document);
