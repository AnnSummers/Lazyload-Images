!function(a,b){"use strict";var c=null,d=function(){return b.addEventListener?function(b,c,d){return b.addEventListener(c,d,!1)}:function(b,c,d){return b.attachEvent("on"+c,d)}}(),e=[60,96,156,248,310,480,620,800,960,1240,1720,2480],f="function"==typeof Object.keys?Object.keys:function(a){var c,b=[];for(c in a)b.push(c);return b},g=function(a){var b=new Image;b.src="data:image/webp;base64,UklGRjoAAABXRUJQVlA4IC4AAACyAgCdASoCAAIALmk0mk0iIiIiIgBoSygABc6WWgAA/veff/0PP8bA//LwYAAA",b.onload=b.onerror=function(){a(2===b.height)}},h=function(a,b){for(var c=0,d=a.length,e=[];c<d;c++)e[c]=b(a[c],c);return e},i=function(a){return a},j=function(){},k=function(){return!0},l=function(a,b){var c;return function(){var d=this,e=arguments,f=function(){c=null,a.apply(d,e)};clearTimeout(c),c=setTimeout(f,b)}},m=function(a,c){var d=this,g=b;c=c||{},void 0!==a&&("string"==typeof a?(c.selector=a,a=void 0):"undefined"==typeof a.length&&(c=a,a=void 0)),this.viewportHeight=g.documentElement.clientHeight,this.selector=a?null:c.selector||".lazyload",this.className=c.className||"image-replace",this.gif=g.createElement("img"),this.gif.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",this.gif.className=this.className,this.gif.alt="",this.lazyloadOffset=c.lazyloadOffset||0,this.scrollDelay=c.scrollDelay||250,this.onResize=!c.hasOwnProperty("onResize")||c.onResize,this.lazyload=!c.hasOwnProperty("lazyload")||c.lazyload,this.scrolled=!1,this.availableWidths=c.availableWidths||e,this.onImagesReplaced=c.onImagesReplaced||j,this.widthsMap={},"function"!=typeof this.availableWidths&&("number"==typeof this.availableWidths.length?this.widthsMap=m.createWidthsMap(this.availableWidths):(this.widthsMap=this.availableWidths,this.availableWidths=f(this.availableWidths)),this.availableWidths=this.availableWidths.sort(function(a,b){return a-b})),this.divs=[],this.add(a||this.selector),this.ready(c.onReady),setTimeout(function(){d.init()},0)};m.prototype.add=function(a){a=a||this.selector;var c="string"==typeof a?b.querySelectorAll(a):a;if(c&&c.length){var d=h(c,i);this.changeDivsToEmptyImages(d),this.divs=this.divs.concat(d)}},m.prototype.scrollCheck=function(){var b=this,c=0,d=[];this.scrolled&&(h(this.divs,function(a){b.isPlaceholder(a)&&(++c,b.isThisElementOnScreen(a)&&d.push(a))}),0===c&&a.clearInterval(b.interval),this.changeDivsToEmptyImages(d),this.scrolled=!1)},m.prototype.init=function(){var a=this;this.initialized=!0;var b=k;this.lazyload?(g(function(b){c=b,a.registerScrollEvent(),a.scrolled=!0,a.scrollCheck()}),b=function(b){return a.isPlaceholder(b)===!1}):g(function(b){c=b,a.checkImagesNeedReplacing(a.divs)}),this.onResize&&this.registerResizeEvent(b),this.onReady()},m.prototype.ready=function(a){this.onReady=a||j},m.prototype.createGif=function(a){if(a.className.match(new RegExp("(^| )"+this.className+"( |$)")))return a;var b=a.getAttribute("data-class"),c=a.getAttribute("data-width"),d=this.gif.cloneNode(!1);return c&&(d.width=c,d.setAttribute("data-width",c)),d.className=(b?b+" ":"")+this.className,d.setAttribute("data-src",a.getAttribute("data-src")),a.getAttribute("data-sizes")&&d.setAttribute("data-sizes",a.getAttribute("data-sizes")),d.setAttribute("alt",a.getAttribute("data-alt")||this.gif.alt),a.parentNode.replaceChild(d,a),d},m.prototype.changeDivsToEmptyImages=function(a){var b=this;h(a,function(c,d){a[d]=b.createGif(c,"img")}),this.initialized&&this.checkImagesNeedReplacing(a)},m.prototype.isPlaceholder=function(a){return a.src===this.gif.src},m.prototype.isThisElementOnScreen=function(a){var b=0,c=m.getPageOffset()+this.lazyloadOffset;if(a.offsetParent)do b+=a.offsetTop;while(a=a.offsetParent);return b<this.viewportHeight+c},m.prototype.checkImagesNeedReplacing=function(a,b){var c=this;b=b||k,this.isResizing||(this.isResizing=!0,h(a,function(a){b(a)&&c.replaceImagesBasedOnScreenDimensions(a)}),this.isResizing=!1,this.onImagesReplaced(a))},m.prototype.replaceImagesBasedOnScreenDimensions=function(a){var b,c,d=!1;c=m.getNaturalWidth(a),b="function"==typeof this.availableWidths?this.availableWidths(a):this.determineAppropriateResolution(a);var e=a.getAttribute("data-src")||"";if(a.getAttribute("data-sizes")){var g,f=JSON.parse(a.getAttribute("data-sizes")),h=[];for(g in f)h.push(g);var i=m.getClosestValue(b,h);i<=b&&(d=!0,e=f[i])}a.width=b,d&&!this.isPlaceholder(a)&&b<=c||(a.src=this.changeImageSrcToUseNewImageDimensions(e,b),a.removeAttribute("width"),a.removeAttribute("height"))},m.prototype.determineAppropriateResolution=function(a){return m.getClosestValue(a.getAttribute("data-width")||a.parentNode.clientWidth,this.availableWidths)},m.prototype.changeImageSrcToUseNewImageDimensions=function(a,b){return a=c?a.replace(/{format}/g,"webp"):a.replace(/{format}/g,"jpeg"),a.replace(/{width}/g,m.transforms.width(b,this.widthsMap))},m.createWidthsMap=function(b){for(var c={},d=b.length;d--;)c[b[d]]=b[d];return c},m.transforms={width:function(a,b){return b[a]||a}},m.getClosestValue=function(b,c){var d=c.length,e=c[d-1];for(b=parseFloat(b);d--;)b<=c[d]&&(e=c[d]);return e},m.prototype.registerResizeEvent=function(b){var c=this;d(a,"resize",l(function(){c.checkImagesNeedReplacing(c.divs,b)},100))},m.prototype.registerScrollEvent=function(){var c=this;this.scrolled=!1,this.interval=a.setInterval(function(){c.scrollCheck()},c.scrollDelay),d(a,"scroll",function(){c.scrolled=!0}),d(a,"resize",function(){c.viewportHeight=b.documentElement.clientHeight,c.scrolled=!0})},m.getPageOffsetGenerator=function(d){return d?function(){return a.pageYOffset}:function(){return b.documentElement.scrollTop}},m.getNaturalWidth=function(){return"naturalWidth"in new Image?function(a){return a.naturalWidth}:function(a){var c=b.createElement("img");return c.src=a.src,c.width}}(),m.getPageOffset=m.getPageOffsetGenerator(Object.prototype.hasOwnProperty.call(a,"pageYOffset")),m.applyEach=h,m.addEvent=d,m.debounce=l,"object"==typeof module&&"object"==typeof module.exports?module.exports=exports=m:"function"==typeof define&&define.amd?define(function(){return m}):"object"==typeof a&&(a.Imager=m)}(window,document);
